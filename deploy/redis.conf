# Redis configuration for darkreach coordinator
# Sidecar deployment on the coordinator node for hot-path worker state.
#
# Worker heartbeats are stored as Redis hashes with 60s TTL, providing:
# - Sub-ms reads for fleet status queries
# - Automatic stale worker cleanup via key expiry
# - ~90% reduction in PostgreSQL write load

# Memory limit: 256MB is sufficient for ~10K worker hashes
maxmemory 256mb
maxmemory-policy allkeys-lru

# Persistence: RDB snapshots every 5 minutes if 100+ keys changed.
# Worker state is ephemeral (rebuilt from heartbeats), so data loss
# on restart is acceptable â€” workers re-register within 10 seconds.
save 300 100

# Bind to localhost only (coordinator-local sidecar)
bind 127.0.0.1
port 6379

# Logging
loglevel notice
logfile /var/log/redis/darkreach-redis.log

# Systemd integration
supervised systemd

# Disable unused features for security
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
