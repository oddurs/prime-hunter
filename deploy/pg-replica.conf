# PostgreSQL streaming replica configuration for darkreach
# Applied to the read replica server (hot standby mode).
#
# The replica receives WAL records from the primary via streaming replication,
# applies them in real-time, and serves read-only queries for the dashboard.

# ── Standby Settings ─────────────────────────────────────────────
hot_standby = on
hot_standby_feedback = on

# Connection info for the primary server
# Set via recovery.conf or as environment variable
# primary_conninfo = 'host=<primary_ip> port=5432 user=replicator password=<password> application_name=replica1'

# ── Memory (match primary for consistent query plans) ────────────
shared_buffers = 8GB
work_mem = 64MB
maintenance_work_mem = 512MB
effective_cache_size = 24GB

# ── Connection Settings ──────────────────────────────────────────
listen_addresses = '*'
port = 5432
max_connections = 200

# ── Query Planner ────────────────────────────────────────────────
random_page_cost = 1.1
effective_io_concurrency = 200

# ── WAL ──────────────────────────────────────────────────────────
# Replica can serve as a cascading replication source
max_wal_senders = 3

# ── Logging ──────────────────────────────────────────────────────
log_min_duration_statement = 1000
log_connections = on
log_disconnections = on

# ── Extensions ───────────────────────────────────────────────────
shared_preload_libraries = 'timescaledb,pg_stat_statements'
